{"body": "I corrected the code based on your suggestions. Also, it seems that all transactions, once they are rolledback or committed, are never changed so that the list of states in the TransactionState class is unnecessary. I've run a pretty simple test where I do the following:\r\n\r\nTopic.transaction do\r\n  while true\r\n    Topic.new\r\n  end\r\nend\r\n\r\nOn my machine (ruby 1.9.3), the amount of memory seems to stabilize pretty quickly and I was able to created millions of objects without any marked increase in memory. Note that the Topic class does not have callbacks.", "url": "https://api.github.com/repos/rails/rails/issues/comments/12731949", "created_at": "2013-01-26T06:49:19Z", "html_url": "https://github.com/rails/rails/pull/9068#issuecomment-12731949", "updated_at": "2013-01-26T06:49:19Z", "repo": "rails", "issue_id": 9068, "user": {"following_url": "https://api.github.com/users/wangjohn/following{/other_user}", "events_url": "https://api.github.com/users/wangjohn/events{/privacy}", "organizations_url": "https://api.github.com/users/wangjohn/orgs", "url": "https://api.github.com/users/wangjohn", "gists_url": "https://api.github.com/users/wangjohn/gists{/gist_id}", "html_url": "https://github.com/wangjohn", "subscriptions_url": "https://api.github.com/users/wangjohn/subscriptions", "avatar_url": "https://2.gravatar.com/avatar/ddbca6015f428461aa5ed3b5f0fb74ab?d=https%3A%2F%2Fidenticons.github.com%2F0f072cda8c91e247b8dd76fa1b10a64e.png", "repos_url": "https://api.github.com/users/wangjohn/repos", "received_events_url": "https://api.github.com/users/wangjohn/received_events", "gravatar_id": "ddbca6015f428461aa5ed3b5f0fb74ab", "starred_url": "https://api.github.com/users/wangjohn/starred{/owner}{/repo}", "login": "wangjohn", "type": "User", "id": 1075780, "followers_url": "https://api.github.com/users/wangjohn/followers"}, "owner": "rails", "_id": {"$oid": "523d5b43bd354364b9006114"}, "id": 12731949, "issue_url": "https://api.github.com/repos/rails/rails/issues/9068"}
