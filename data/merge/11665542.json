{"issue_url": "https://api.github.com/repos/rails/rails/issues/7980", "repo": "rails", "body": "That seems reasonable to me.\r\n\r\nOn Dec 24, 2012, at 11:46 AM, John Firebaugh <notifications@github.com> wrote:\r\n\r\n> I agree with reverting to last IP and documenting the trusted proxy option.\r\n> \r\n> What I would like to see is an option to ignore HTTP_CLIENT_IP. In an EC2+ELB environment that header is effectively garbage and should be ignored (ELB only uses X-Forwarded-For, not Client-IP). The fact that it is used to try to detect spoofing results in legitimate users getting locked out. If not an option, then at least extract some finer-grained methods so I can monkey patch more easily.\r\n> \r\n> def client_ip\r\n>   @env['HTTP_CLIENT_IP']\r\n> end\r\n> \r\n> def forwarded_ips\r\n>   ips_from('HTTP_X_FORWARDED_FOR')\r\n> end\r\n> \r\n> def remote_addrs\r\n>   ips_from('REMOTE_ADDR').reverse\r\n> end\r\n> \r\n> def candidate_ips\r\n>   [client_ip, forwarded_ips, remote_addrs].flatten.compact\r\n> end\r\n> \r\n> def remote_ip\r\n>   remove_proxies(candidate_ips).first || remote_addrs.first\r\n> end\r\n> \u0081\\\r\n> Reply to this email directly or view it on GitHub.\r\n> ", "_id": {"$oid": "523db5b8bd354364b90095f0"}, "issue_id": 7980, "url": "https://api.github.com/repos/rails/rails/issues/comments/11665542", "html_url": "https://github.com/rails/rails/pull/7980#issuecomment-11665542", "updated_at": "2012-12-24T20:28:00Z", "user": {"subscriptions_url": "https://api.github.com/users/indirect/subscriptions", "events_url": "https://api.github.com/users/indirect/events{/privacy}", "repos_url": "https://api.github.com/users/indirect/repos", "gists_url": "https://api.github.com/users/indirect/gists{/gist_id}", "url": "https://api.github.com/users/indirect", "login": "indirect", "gravatar_id": "4c3ed917e59156a36212d48155831482", "html_url": "https://github.com/indirect", "following_url": "https://api.github.com/users/indirect/following{/other_user}", "received_events_url": "https://api.github.com/users/indirect/received_events", "organizations_url": "https://api.github.com/users/indirect/orgs", "avatar_url": "https://0.gravatar.com/avatar/4c3ed917e59156a36212d48155831482?d=https%3A%2F%2Fidenticons.github.com%2F35f4a8d465e6e1edc05f3d8ab658c551.png", "starred_url": "https://api.github.com/users/indirect/starred{/owner}{/repo}", "id": 78, "followers_url": "https://api.github.com/users/indirect/followers", "type": "User"}, "created_at": "2012-12-24T20:28:00Z", "id": 11665542, "owner": "rails"}
