{"issue_url": "https://api.github.com/repos/rails/rails/issues/6952", "repo": "rails", "body": "I also discussed the issue with [Jean-Philippe Aumasson](http://www.131002.net). It was my impression and he confirmed that PBKDF2 is not the optimal choice in your context. PBKDF2 was designed to mitigate the poor entropy of passwords, but as you confirmed you would be using a SecureRandom master secret right from the start, there is no need for a password-based derivation algorithm.\n\nI thought of something simple at first, like KDF 1-4 on this [page](http://www.131002.net), but Jean-Philippe warned me that there are [issues](http://eprint.iacr.org/2011/649.pdf) when deriving keys in that manner. To overcome these problems, he recommended HMAC as a good solution.\n\nIt turns out that there is a standard using HMAC for key derivation that provides all of the features you are looking for, [HKDF](http://tools.ietf.org/html/rfc5869). It also comes with a [paper](http://eprint.iacr.org/2010/264.pdf).\n\nIn your situation, where you have a SecureRandom master key, you could skip the \"Extract\" phase altogether, and immediately use the \"Expand\" phase. Determinism is supported by providing appropriate \"info\" strings (see also the comments in section 3.2) to \n\n    HKDF-Expand(PRK, info, L)\n\nAs the underlying hash function, I would recommend to use SHA-256. This solution has the advantage that there's no need for salt values at all since your initial key material is already secure pseudo-random. \n\nOn the downside, there's no implementation in stdlib available so far. But I wanted to add key derivation support to Ruby OpenSSL for quite some time now, because it's also important for key exchange protocols. \n\n@nahi Would you think it's OK to add HKDF support to Ruby OpenSSL even if it's not directly supported by OpenSSL itself? My guess is we could implement it entirely in Ruby, probably no need for native code.\n\nAlternatively, you could use [this gem](https://github.com/jtdowney/hkdf) or we could discuss adding a reduced version (\"Expand\" only) to Rails directly. What do you think?", "_id": {"$oid": "52380195bd3543c15100c175"}, "issue_id": 6952, "url": "https://api.github.com/repos/rails/rails/issues/comments/6822536", "html_url": "https://github.com/rails/rails/pull/6952#issuecomment-6822536", "updated_at": "2012-07-07T14:34:57Z", "user": {"subscriptions_url": "https://api.github.com/users/emboss/subscriptions", "events_url": "https://api.github.com/users/emboss/events{/privacy}", "repos_url": "https://api.github.com/users/emboss/repos", "gists_url": "https://api.github.com/users/emboss/gists{/gist_id}", "url": "https://api.github.com/users/emboss", "login": "emboss", "gravatar_id": "ada56d152c1abe0eba65a5ff62ed5387", "html_url": "https://github.com/emboss", "following_url": "https://api.github.com/users/emboss/following{/other_user}", "received_events_url": "https://api.github.com/users/emboss/received_events", "organizations_url": "https://api.github.com/users/emboss/orgs", "avatar_url": "https://0.gravatar.com/avatar/ada56d152c1abe0eba65a5ff62ed5387?d=https%3A%2F%2Fidenticons.github.com%2F3e0ccfd5b27c3147b2a9e7d02f862c91.png", "starred_url": "https://api.github.com/users/emboss/starred{/owner}{/repo}", "id": 486012, "followers_url": "https://api.github.com/users/emboss/followers", "type": "User"}, "created_at": "2012-07-07T12:07:24Z", "id": 6822536, "owner": "rails"}
