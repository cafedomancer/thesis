{"body": "Thanks:\r\n\r\nThese comments:\r\n# blocks, so separate script called by Kernel#system is needed.\r\n# (See exec vs. async_exec in the PostgreSQL adapter.)\r\n\r\nMake me suspicious that Postgres, or the test case,  is doing  \r\nsomething that violates ActiveRecord's concurrency contract (using a  \r\nconnection checked out in one thread in another thread simultaneously,  \r\nor using a connection after you've checked it back in), but in a way  \r\nthat only triggered the test failure once you actually fix AR  \r\nconcurrency.  This could be hard to find/fix, especially if it  \r\ninvolves C code.\r\n\r\nI'll think more on it, and try to debug it if I can get postgres set  \r\nup locally.\r\n\r\nI wonder if you wrap the whole failing test in a  \r\n`Person.with_connection do` if that would make it pass... and if it  \r\nwould, what that says and if that's acceptable anyway. Very confusing  \r\nstuff.\r\n\r\nOn Sep 18, 2012, at 9:27 PM, Rafael Mendon\u00e7a Fran\u00e7a wrote:\r\n\r\n> This was my fix for the sql related tests. rails/rails@a82f1e3\r\n>\r\n> The lockin related failure is:\r\n>\r\n>   6) Failure:\r\n> test_sane_lock_method(PessimisticLockingTest) [/Users/rafaelmfranca/ \r\n> Projects/github/rails/activerecord/test/cases/locking_test.rb:409]:\r\n> Exception raised:\r\n> <#<ActiveRecord::StatementInvalid: PG::Error: ERROR:  current  \r\n> transaction is aborted, commands ignored until end of transaction  \r\n> block\r\n> : SELECT  \"people\".* FROM \"people\"  WHERE \"people\".\"id\" = $1 LIMIT  \r\n> 1>>.\r\n> \u2014\r\n> Reply to this email directly or view it on GitHub.\r\n>\r\n>", "url": "https://api.github.com/repos/rails/rails/issues/comments/8676598", "created_at": "2012-09-19T01:38:52Z", "html_url": "https://github.com/rails/rails/pull/7675#issuecomment-8676598", "updated_at": "2012-09-19T01:38:52Z", "repo": "rails", "issue_id": 7675, "user": {"following_url": "https://api.github.com/users/jrochkind/following{/other_user}", "events_url": "https://api.github.com/users/jrochkind/events{/privacy}", "organizations_url": "https://api.github.com/users/jrochkind/orgs", "url": "https://api.github.com/users/jrochkind", "gists_url": "https://api.github.com/users/jrochkind/gists{/gist_id}", "html_url": "https://github.com/jrochkind", "subscriptions_url": "https://api.github.com/users/jrochkind/subscriptions", "avatar_url": "https://0.gravatar.com/avatar/6a13e655e637138f8d571cec3f9cea76?d=https%3A%2F%2Fidenticons.github.com%2Fd54ea80e1dddb765bab019d4dfe36c23.png", "repos_url": "https://api.github.com/users/jrochkind/repos", "received_events_url": "https://api.github.com/users/jrochkind/received_events", "gravatar_id": "6a13e655e637138f8d571cec3f9cea76", "starred_url": "https://api.github.com/users/jrochkind/starred{/owner}{/repo}", "login": "jrochkind", "type": "User", "id": 149304, "followers_url": "https://api.github.com/users/jrochkind/followers"}, "owner": "rails", "_id": {"$oid": "523dd20bbd354364b900a7a3"}, "id": 8676598, "issue_url": "https://api.github.com/repos/rails/rails/issues/7675"}
