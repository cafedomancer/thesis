{"updated_at": "2013-07-23T16:53:19Z", "repo": "rails", "created_at": "2013-07-23T16:53:05Z", "owner": "rails", "url": "https://api.github.com/repos/rails/rails/issues/comments/21428708", "id": 21428708, "issue_url": "https://api.github.com/repos/rails/rails/issues/6376", "issue_id": 6376, "user": {"repos_url": "https://api.github.com/users/micahwedemeyer/repos", "type": "User", "html_url": "https://github.com/micahwedemeyer", "starred_url": "https://api.github.com/users/micahwedemeyer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/micahwedemeyer/subscriptions", "following_url": "https://api.github.com/users/micahwedemeyer/following{/other_user}", "gravatar_id": "3b571d666258482cdc91e95df0942ede", "organizations_url": "https://api.github.com/users/micahwedemeyer/orgs", "url": "https://api.github.com/users/micahwedemeyer", "gists_url": "https://api.github.com/users/micahwedemeyer/gists{/gist_id}", "avatar_url": "https://2.gravatar.com/avatar/3b571d666258482cdc91e95df0942ede?d=https%3A%2F%2Fidenticons.github.com%2F08bded4b29e13c27e400662136eadbeb.png", "id": 11465, "events_url": "https://api.github.com/users/micahwedemeyer/events{/privacy}", "login": "micahwedemeyer", "received_events_url": "https://api.github.com/users/micahwedemeyer/received_events", "followers_url": "https://api.github.com/users/micahwedemeyer/followers"}, "body": "Correct me if I'm wrong, but I think this will cause cache misses with persistence layers that don't support nanosecond-level precision.\r\n\r\nIf a model (a User, for example) is updated, for that request it will have a high-precision cache key (note: 5 trailing 0's):\r\n\r\n    users/1-20130723161450634100000\r\n\r\nAny cache keys created during that request will be based on the nanosecond-level precision.\r\n\r\nOn subsequent requests, when the model is loaded fresh from the database, it will have the lower precision cache-key, like so (note: 10 trailing 0's):\r\n\r\n    users/1-20130723161450000000000\r\n\r\nSo, despite the fact that the model has not been touched in the intervening time, the cache keys don't match and you will get a miss. At that point, it will (probably) be re-cached with the lower-precision time stamp and future requests will be a hit.\r\n\r\nIf I'm understanding correctly, this will result in an automatic cache miss for any model that is updated and cached in the same request, unless you call reload() on it prior to caching. Reload will \"truncate\" the updated_at precision down to whatever the underlying persistence level supports.\r\n\r\nAm I missing something?", "_id": {"$oid": "52380a2cbd3543c15100ced1"}, "html_url": "https://github.com/rails/rails/pull/6376#issuecomment-21428708"}
