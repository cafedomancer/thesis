{"body": "This patch breaks `belongs_to :foo, touch: true` associations:\r\n\r\n```ruby\r\nclass Order < ActiveRecord::Base; end\r\nclass Invoice < ActiveRecord::Base\r\n  belongs_to :order, touch: true\r\nend\r\n\r\ninvoice = Invoice.new\r\ninvoice.order = Order.new\r\ninvoice.save! # ActiveRecord::ActiveRecordError: can not touch on a new record object\r\n```\r\n\r\nHere's the relevant part of the backtrace:\r\n\r\n```\r\nactiverecord-4.0.0.beta1/lib/active_record/persistence.rb:378:in `touch'\r\nactiverecord-4.0.0.beta1/lib/active_record/callbacks.rb:293:in `block in touch'\r\nactivesupport-4.0.0.beta1/lib/active_support/callbacks.rb:373:in `_run__3041656240602960411__touch__callbacks'\r\nactivesupport-4.0.0.beta1/lib/active_support/callbacks.rb:78:in `run_callbacks'\r\nactiverecord-4.0.0.beta1/lib/active_record/callbacks.rb:293:in `touch'\r\nactiverecord-4.0.0.beta1/lib/active_record/associations/builder/belongs_to.rb:52:in `belongs_to_touch_after_save_or_destroy_for_order'\r\nactivesupport-4.0.0.beta1/lib/active_support/callbacks.rb:397:in `_run__798865968065935246__save__callbacks'\r\nactivesupport-4.0.0.beta1/lib/active_support/callbacks.rb:78:in `run_callbacks'\r\nactiverecord-4.0.0.beta1/lib/active_record/callbacks.rb:299:in `create_or_update'\r\nactiverecord-4.0.0.beta1/lib/active_record/persistence.rb:122:in `save!'\r\n```\r\n\r\nI don't know what the proper fix should be, but maybe until it's fixed, this patch should be reverted?", "url": "https://api.github.com/repos/rails/rails/issues/comments/14105189", "created_at": "2013-02-26T10:34:19Z", "html_url": "https://github.com/rails/rails/pull/9320#issuecomment-14105189", "updated_at": "2013-02-26T10:34:19Z", "repo": "rails", "issue_id": 9320, "user": {"following_url": "https://api.github.com/users/exviva/following{/other_user}", "events_url": "https://api.github.com/users/exviva/events{/privacy}", "organizations_url": "https://api.github.com/users/exviva/orgs", "url": "https://api.github.com/users/exviva", "gists_url": "https://api.github.com/users/exviva/gists{/gist_id}", "html_url": "https://github.com/exviva", "subscriptions_url": "https://api.github.com/users/exviva/subscriptions", "avatar_url": "https://2.gravatar.com/avatar/56c0f984e7a1cccbd5ea165ef310ba4f?d=https%3A%2F%2Fidenticons.github.com%2Fa77d299ee00dfee2de17de8fcd02c69a.png", "repos_url": "https://api.github.com/users/exviva/repos", "received_events_url": "https://api.github.com/users/exviva/received_events", "gravatar_id": "56c0f984e7a1cccbd5ea165ef310ba4f", "starred_url": "https://api.github.com/users/exviva/starred{/owner}{/repo}", "login": "exviva", "type": "User", "id": 80070, "followers_url": "https://api.github.com/users/exviva/followers"}, "owner": "rails", "_id": {"$oid": "5237eab5bd3543c151009a48"}, "id": 14105189, "issue_url": "https://api.github.com/repos/rails/rails/issues/9320"}
