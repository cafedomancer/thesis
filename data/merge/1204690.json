{"updated_at": "2011-05-19T16:39:14Z", "repo": "rails", "created_at": "2011-05-19T16:39:14Z", "owner": "rails", "url": "https://api.github.com/repos/rails/rails/issues/comments/1204690", "id": 1204690, "issue_url": "https://api.github.com/repos/rails/rails/issues/563", "issue_id": 563, "user": {"repos_url": "https://api.github.com/users/NZKoz/repos", "type": "User", "html_url": "https://github.com/NZKoz", "starred_url": "https://api.github.com/users/NZKoz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NZKoz/subscriptions", "following_url": "https://api.github.com/users/NZKoz/following{/other_user}", "gravatar_id": "efa76b164a7de4a5730e4fa397cc4425", "organizations_url": "https://api.github.com/users/NZKoz/orgs", "url": "https://api.github.com/users/NZKoz", "gists_url": "https://api.github.com/users/NZKoz/gists{/gist_id}", "avatar_url": "https://1.gravatar.com/avatar/efa76b164a7de4a5730e4fa397cc4425?d=https%3A%2F%2Fidenticons.github.com%2F85d8ce590ad8981ca2c8286f79f59954.png", "id": 197, "events_url": "https://api.github.com/users/NZKoz/events{/privacy}", "login": "NZKoz", "received_events_url": "https://api.github.com/users/NZKoz/received_events", "followers_url": "https://api.github.com/users/NZKoz/followers"}, "body": "I'm not sure there's any value in trying to have unit tests which 'test' these thread safety issues.  The reality is that there's no way to guarantee that they'll fail as it comes down to non-deterministic behaviour so we could break it again and not have the tests complain at all.\r\n\r\nHowever I'm not sure I see why you don't just use the single mutex rather than introducing this hash subclass.   Without a mutex around clear_stale_cached_connections! there's nothing preventing the method from being called in parallel and while it won't break by mutating a hash in parallel, you probably don't want it to be clearing the cach in two different threads.", "_id": {"$oid": "52385e32bd3543c15101203b"}, "html_url": "https://github.com/rails/rails/pull/563#issuecomment-1204690"}
