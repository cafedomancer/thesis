{"updated_at": "2012-05-16T16:42:57Z", "repo": "rails", "created_at": "2012-05-16T16:42:57Z", "owner": "rails", "url": "https://api.github.com/repos/rails/rails/issues/comments/5745647", "id": 5745647, "issue_url": "https://api.github.com/repos/rails/rails/issues/6336", "issue_id": 6336, "user": {"repos_url": "https://api.github.com/users/carlosantoniodasilva/repos", "type": "User", "html_url": "https://github.com/carlosantoniodasilva", "starred_url": "https://api.github.com/users/carlosantoniodasilva/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/carlosantoniodasilva/subscriptions", "following_url": "https://api.github.com/users/carlosantoniodasilva/following{/other_user}", "gravatar_id": "77237b97a465ae5a293ad323b7296837", "organizations_url": "https://api.github.com/users/carlosantoniodasilva/orgs", "url": "https://api.github.com/users/carlosantoniodasilva", "gists_url": "https://api.github.com/users/carlosantoniodasilva/gists{/gist_id}", "avatar_url": "https://0.gravatar.com/avatar/77237b97a465ae5a293ad323b7296837?d=https%3A%2F%2Fidenticons.github.com%2F60b997fd68261ce70cadaf6c8226c042.png", "id": 26328, "events_url": "https://api.github.com/users/carlosantoniodasilva/events{/privacy}", "login": "carlosantoniodasilva", "received_events_url": "https://api.github.com/users/carlosantoniodasilva/received_events", "followers_url": "https://api.github.com/users/carlosantoniodasilva/followers"}, "body": "Hey @erichmenge .. I thought about this solution at first, but decided to try a different path, to use the first available column type from the result, as we should always get only one type back:\n\n```diff\n# calculations\n-      types  = result.column_types.merge klass.column_types\n-      column = types[key]\n+      column = klass.column_types[key] || result.column_types.values.first\n \n       result.map do |attributes|\n         raise ArgumentError, \"Pluck expects to select just one attribute: #{attributes.\n-        value = klass.initialize_attributes(attributes).first[1]\n+        value = klass.initialize_attributes(attributes).values.first\n         if column\n           column.type_cast value\n         else\n\n\n# test\n   def test_pluck_with_selection_clause\n     assert_equal [50, 53, 55, 60], Account.pluck('DISTINCT credit_limit').sort\n+    assert_equal [50, 53, 55, 60], Account.pluck('DISTINCT accounts.credit_limit').sort\n+    assert_equal [50, 53, 55, 60], Account.pluck('DISTINCT(credit_limit)').sort\n+    assert_equal [50 + 53 + 55 + 60], Account.pluck('SUM(DISTINCT(credit_limit))')\n```\n\nI added your test line as well, everything seems fine with these changes, and we're covering more possibilities. Can you update your pull request accordingly? I'll merge it then, thanks!", "_id": {"$oid": "52380b50bd3543c15100cfec"}, "html_url": "https://github.com/rails/rails/pull/6336#issuecomment-5745647"}
