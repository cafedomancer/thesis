{"body": "Hey Lawrence! It looks good BUT I would move the method to the class\r\nand cache on each class using @instance_class_variable. The current\r\nimplementation causes memory leaks in development (as each class is\r\ndifferent).\r\n\r\nThanks a lot!\r\n\r\nEm quinta-feira, 14 de julho de 2011,\r\nlawrencepit<reply@reply.github.com>\r\nescreveu:\r\n> In production mode we were measuring the number of objects created, because the GC was working too hard imo, esp. compared to rails2.\r\n>\r\n> Typically we got these numbers per request, the top 5:\r\n>\r\n> \u00a0Total: 134949 samples\r\n>  \u00a0 20460 \u00a015.2% \u00a015.2% \u00a0 \u00a022374 \u00a016.6% Object#match_attribute_method?\r\n>  \u00a0 \u00a06907 \u00a0 5.1% \u00a020.3% \u00a0 \u00a038812 \u00a028.8% Array#map\r\n>  \u00a0 \u00a05662 \u00a0 4.2% \u00a024.5% \u00a0 \u00a0 5662 \u00a0 4.2% Set#subtract\r\n>  \u00a0 \u00a04359 \u00a0 3.2% \u00a027.7% \u00a0 \u00a0 5513 \u00a0 4.1% Set#merge\r\n>  \u00a0 \u00a03762 \u00a0 2.8% \u00a030.5% \u00a0 \u00a018610 \u00a013.8% Object#read_attribute\r\n>  \u00a0 \u00a03288 \u00a0 2.4% \u00a032.9% \u00a0 \u00a018607 \u00a013.8% ActiveRecord::Base#attributes\r\n>\r\n> So for every request about 15% of all objects created, are created by the calls to match_attribute_method? in ActiveModel.\r\n>\r\n> At 10 requests/second, this patch saves over 10 million objects per minute for us in production mode.\r\n>\r\n> I'm however not that familiar with ActiveModel, and this is probably not the best way to solve this. But I thought I put this out there first and work from there. My main question atm is: are there times when this cache would need to be cleared?\r\n>\r\n> --\r\n> Reply to this email directly or view it on GitHub:\r\n> https://github.com/rails/rails/pull/2075\r\n>\r\n\r\n-- \r\n\r\n\r\n*\r\nJos\u00e9 Valim\r\nwww.plataformatec.com.br\r\nFounder and Lead Developer\r\n*", "url": "https://api.github.com/repos/rails/rails/issues/comments/1580221", "created_at": "2011-07-15T14:46:32Z", "html_url": "https://github.com/rails/rails/pull/2075#issuecomment-1580221", "updated_at": "2011-07-15T14:46:32Z", "repo": "rails", "issue_id": 2075, "user": {"following_url": "https://api.github.com/users/josevalim/following{/other_user}", "events_url": "https://api.github.com/users/josevalim/events{/privacy}", "organizations_url": "https://api.github.com/users/josevalim/orgs", "url": "https://api.github.com/users/josevalim", "gists_url": "https://api.github.com/users/josevalim/gists{/gist_id}", "html_url": "https://github.com/josevalim", "subscriptions_url": "https://api.github.com/users/josevalim/subscriptions", "avatar_url": "https://0.gravatar.com/avatar/e837f6b7fd146ab16ed3d663476c063e?d=https%3A%2F%2Fidenticons.github.com%2Fe20b21ae6508f22fc189c60a0880d0b8.png", "repos_url": "https://api.github.com/users/josevalim/repos", "received_events_url": "https://api.github.com/users/josevalim/received_events", "gravatar_id": "e837f6b7fd146ab16ed3d663476c063e", "starred_url": "https://api.github.com/users/josevalim/starred{/owner}{/repo}", "login": "josevalim", "type": "User", "id": 9582, "followers_url": "https://api.github.com/users/josevalim/followers"}, "owner": "rails", "_id": {"$oid": "52384887bd3543c151011177"}, "id": 1580221, "issue_url": "https://api.github.com/repos/rails/rails/issues/2075"}
