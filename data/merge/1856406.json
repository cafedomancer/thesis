{"updated_at": "2011-08-19T20:40:49Z", "repo": "rails", "created_at": "2011-08-19T20:40:49Z", "owner": "rails", "url": "https://api.github.com/repos/rails/rails/issues/comments/1856406", "id": 1856406, "issue_url": "https://api.github.com/repos/rails/rails/issues/2490", "issue_id": 2490, "user": {"repos_url": "https://api.github.com/users/adamcrown/repos", "type": "User", "html_url": "https://github.com/adamcrown", "starred_url": "https://api.github.com/users/adamcrown/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adamcrown/subscriptions", "following_url": "https://api.github.com/users/adamcrown/following{/other_user}", "gravatar_id": "8e376bdb110a47cc06658bf84d46d515", "organizations_url": "https://api.github.com/users/adamcrown/orgs", "url": "https://api.github.com/users/adamcrown", "gists_url": "https://api.github.com/users/adamcrown/gists{/gist_id}", "avatar_url": "https://1.gravatar.com/avatar/8e376bdb110a47cc06658bf84d46d515?d=https%3A%2F%2Fidenticons.github.com%2Fa0d85a3e1a35b95531490bbd86e87c34.png", "id": 277306, "events_url": "https://api.github.com/users/adamcrown/events{/privacy}", "login": "adamcrown", "received_events_url": "https://api.github.com/users/adamcrown/received_events", "followers_url": "https://api.github.com/users/adamcrown/followers"}, "body": "As best I can figure, the logic behind this line\r\n\r\n    return forwarded_ips.reject { |ip| ip =~ @trusted_proxies }.last || @env[\"REMOTE_ADDR\"]\r\n\r\nis that it's trying to remove all of the proxy IPs leaving only one client IP. In which case `first` or `last` wouldn't matter. However that doesn't always work. Just because an IP is in the `trusted_proxies` range doesn't mean it's actually a proxy. And this line can wind up stripping out the client's IP as well.\r\n\r\nThere's another issues that covers this problem: https://github.com/rails/rails/issues/1010.\r\n\r\nIt seems like this would be a better solution.\r\n\r\nreturn forwarded_ips.first || @env[\"REMOTE_ADDR\"]", "_id": {"$oid": "52384314bd3543c151010ba0"}, "html_url": "https://github.com/rails/rails/pull/2490#issuecomment-1856406"}
