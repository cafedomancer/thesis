{"issue_url": "https://api.github.com/repos/rails/rails/issues/6034", "repo": "rails", "body": "Thanks guys.  Hoping we can get it into 3-1-stable too to be on the safe side since it's almost a security issue, but will understand if we're only maintaining one version back as usual.\r\n\r\nJos\u00e9, I see that a while back you contributed a test which *almost* caught this bug - test_just_using_flash_does_not_stream_a_cookie_back.  Frustratingly, although the test is useful, the buggy code didn't fail this test because it only triggered the session cookie on the response if the request had both a session cookie and a flash key in it:\r\n\r\n```ruby\r\n      if (session = env['rack.session']) && (flash = session['flash'])\r\n        flash.sweep\r\n      end\r\n```\r\n\r\n(obviously users will have this if they have hit other actions first, even if this request doesn't use the session.)\r\n\r\nSo I am trying to adapt that test to set the session cookie up properly but struggling a bit.  @dragus, I'd love some help with this, thanks!\r\n\r\nBasically all I want to add to the above test is request.session['flash'] = {:foo => :bar}.  But this being a framework test rather than a controller test, request.session isn't set up, nor is request.cookie_jar to set request.cookie_jar.signed[SessionKey] directly.  \r\n\r\nAny ideas?  I'd really like to avoid coping in all the session cookie code because it feels to me like that would be a very brittle test that would stop testing anything useful when the session code is changed.", "_id": {"$oid": "52380fd5bd3543c15100d5b1"}, "issue_id": 6034, "url": "https://api.github.com/repos/rails/rails/issues/comments/5404764", "html_url": "https://github.com/rails/rails/pull/6034#issuecomment-5404764", "updated_at": "2012-04-29T12:48:58Z", "user": {"subscriptions_url": "https://api.github.com/users/willbryant/subscriptions", "events_url": "https://api.github.com/users/willbryant/events{/privacy}", "repos_url": "https://api.github.com/users/willbryant/repos", "gists_url": "https://api.github.com/users/willbryant/gists{/gist_id}", "url": "https://api.github.com/users/willbryant", "login": "willbryant", "gravatar_id": "f1c9a2d6b6be7599854a75793ecd872d", "html_url": "https://github.com/willbryant", "following_url": "https://api.github.com/users/willbryant/following{/other_user}", "received_events_url": "https://api.github.com/users/willbryant/received_events", "organizations_url": "https://api.github.com/users/willbryant/orgs", "avatar_url": "https://1.gravatar.com/avatar/f1c9a2d6b6be7599854a75793ecd872d?d=https%3A%2F%2Fidenticons.github.com%2F60be21f3ebf28ff7b8a692a752d92cf8.png", "starred_url": "https://api.github.com/users/willbryant/starred{/owner}{/repo}", "id": 12062, "followers_url": "https://api.github.com/users/willbryant/followers", "type": "User"}, "created_at": "2012-04-29T12:48:58Z", "id": 5404764, "owner": "rails"}
