{"issue_url": "https://api.github.com/repos/rails/rails/issues/2499", "repo": "rails", "body": "Sorry for the confusion, the diff doesn't make things clear, hence the longish description.  assert_email_select didn't actually test anything previously for non-multipart emails because the inner loop was never run because delivery.parts is always empty for non-multipart.  Because the inner code was never run, it looked like the previous tests were valid.\r\n\r\nBecause assert_email_select didn't really do anything (because it is broken), the existing tests (for non-multipart) passed anyway.  The diff adds tests for multipart emails, but the fix also makes the tests that already existed (for non-multipart) actually run correctly now; the inner loop now has a \"body\" to perform assert_select against.\r\n\r\nBasically, there are tests for multipart and non-multipart.  The former tests already existed, but didn't really test anything because the tests weren't actually working correctly.  The latter tests were added in the diff.  The fix I've made now allows the former tests (that already exist) to run correctly... they now assert_select against the email body.\r\n\r\nThe error fixed with to_s only appeared with multipart emails, which there were no tests for previously.  The tests I added test multipart emails which all pass because of the to_s fix.  If to_s is removed the multipart email tests will fail.\r\n\r\nIt's a bit confusing because everything previously didn't do anything, so I've made what already existed work properly again which in the test code didn't require any new changes for non-multipart... the prior tests work fine now with this diff applied.\r\n\r\nDoes that clear it up?", "_id": {"$oid": "523842fcbd3543c151010b8b"}, "issue_id": 2499, "url": "https://api.github.com/repos/rails/rails/issues/comments/2026642", "html_url": "https://github.com/rails/rails/pull/2499#issuecomment-2026642", "updated_at": "2011-09-07T08:24:07Z", "user": {"subscriptions_url": "https://api.github.com/users/akaspick/subscriptions", "events_url": "https://api.github.com/users/akaspick/events{/privacy}", "repos_url": "https://api.github.com/users/akaspick/repos", "gists_url": "https://api.github.com/users/akaspick/gists{/gist_id}", "url": "https://api.github.com/users/akaspick", "login": "akaspick", "gravatar_id": "898bf26eb61308fe717a243441cc615d", "html_url": "https://github.com/akaspick", "following_url": "https://api.github.com/users/akaspick/following{/other_user}", "received_events_url": "https://api.github.com/users/akaspick/received_events", "organizations_url": "https://api.github.com/users/akaspick/orgs", "avatar_url": "https://2.gravatar.com/avatar/898bf26eb61308fe717a243441cc615d?d=https%3A%2F%2Fidenticons.github.com%2F82c3cf12914d43d34d8883ec88307da2.png", "starred_url": "https://api.github.com/users/akaspick/starred{/owner}{/repo}", "id": 24056, "followers_url": "https://api.github.com/users/akaspick/followers", "type": "User"}, "created_at": "2011-09-07T08:24:07Z", "id": 2026642, "owner": "rails"}
