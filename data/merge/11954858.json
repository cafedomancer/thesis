{"updated_at": "2013-01-07T15:11:03Z", "repo": "rails", "created_at": "2013-01-07T15:11:03Z", "owner": "rails", "url": "https://api.github.com/repos/rails/rails/issues/comments/11954858", "id": 11954858, "issue_url": "https://api.github.com/repos/rails/rails/issues/7661", "issue_id": 7661, "user": {"repos_url": "https://api.github.com/users/ernie/repos", "type": "User", "html_url": "https://github.com/ernie", "starred_url": "https://api.github.com/users/ernie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ernie/subscriptions", "following_url": "https://api.github.com/users/ernie/following{/other_user}", "gravatar_id": "2274a7476f6d2ac7aedcdec0651d0542", "organizations_url": "https://api.github.com/users/ernie/orgs", "url": "https://api.github.com/users/ernie", "gists_url": "https://api.github.com/users/ernie/gists{/gist_id}", "avatar_url": "https://2.gravatar.com/avatar/2274a7476f6d2ac7aedcdec0651d0542?d=https%3A%2F%2Fidenticons.github.com%2F6a600c968f4e6a843dcaf600c1694e42.png", "id": 14947, "events_url": "https://api.github.com/users/ernie/events{/privacy}", "login": "ernie", "received_events_url": "https://api.github.com/users/ernie/received_events", "followers_url": "https://api.github.com/users/ernie/followers"}, "body": "@gnufied Your demonstration says that the validation is running thrice, but that doesn't (necessarily) mean the creation occurs thrice. See the following code from has_many_through_association.rb:\r\n\r\n```ruby\r\n        # We temporarily cache through record that has been build, because if we build a\r\n        # through record in build_record and then subsequently call insert_record, then we\r\n        # want to use the exact same object.\r\n        #\r\n        # However, after insert_record has been called, we clear the cache entry because\r\n        # we want it to be possible to have multiple instances of the same record in an\r\n        # association\r\n        def build_through_record(record)\r\n          @through_records[record.object_id] ||= begin\r\n            ensure_mutable\r\n\r\n            through_record = through_association.build\r\n            through_record.send(\"#{source_reflection.name}=\", record)\r\n            through_record\r\n          end\r\n        end\r\n```\r\n\r\nHave you verified you end up with three through records?.\r\n\r\nAdditionally, the most in-depth discussion (and request for feedback from @tenderlove and @jonleighton) regarding this change was at #8269.", "_id": {"$oid": "5237f947bd3543c15100b40b"}, "html_url": "https://github.com/rails/rails/pull/7661#issuecomment-11954858"}
