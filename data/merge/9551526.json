{"updated_at": "2012-10-18T02:41:52Z", "repo": "rails", "created_at": "2012-10-18T02:41:52Z", "owner": "rails", "url": "https://api.github.com/repos/rails/rails/issues/comments/9551526", "id": 9551526, "issue_url": "https://api.github.com/repos/rails/rails/issues/7980", "issue_id": 7980, "user": {"repos_url": "https://api.github.com/users/indirect/repos", "type": "User", "html_url": "https://github.com/indirect", "starred_url": "https://api.github.com/users/indirect/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/indirect/subscriptions", "following_url": "https://api.github.com/users/indirect/following{/other_user}", "gravatar_id": "4c3ed917e59156a36212d48155831482", "organizations_url": "https://api.github.com/users/indirect/orgs", "url": "https://api.github.com/users/indirect", "gists_url": "https://api.github.com/users/indirect/gists{/gist_id}", "avatar_url": "https://0.gravatar.com/avatar/4c3ed917e59156a36212d48155831482?d=https%3A%2F%2Fidenticons.github.com%2F35f4a8d465e6e1edc05f3d8ab658c551.png", "id": 78, "events_url": "https://api.github.com/users/indirect/events{/privacy}", "login": "indirect", "received_events_url": "https://api.github.com/users/indirect/received_events", "followers_url": "https://api.github.com/users/indirect/followers"}, "body": "Ohhh, I understand what the problem is now. Many proxies don't actually modify the X-Forwarded-For header. Instead, they add _another_ X-Forwarded-For header. According to the HTTP spec, that means that the values should be concatenated, joined by a comma. If you're using [a ruby server that understands repeated headers](http://andre.arko.net/2011/12/26/repeated-headers-and-ruby-web-servers/), the correct IP will then be the last value. If the proxy conforms to the W3C spec that you linked, the correct IP will be the first value.\r\n\r\nUm. How can we resolve this? FWIW, I've only ever seen the \"adds a second header\" proxy type in the wild (I know HAProxy does this).", "_id": {"$oid": "523db5b8bd354364b90095bd"}, "html_url": "https://github.com/rails/rails/pull/7980#issuecomment-9551526"}
