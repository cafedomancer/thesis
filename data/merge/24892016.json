{"updated_at": "2013-09-22T22:30:22Z", "repo": "rails", "created_at": "2013-09-22T22:21:41Z", "owner": "rails", "url": "https://api.github.com/repos/rails/rails/issues/comments/24892016", "id": 24892016, "issue_url": "https://api.github.com/repos/rails/rails/issues/12315", "issue_id": 12315, "user": {"repos_url": "https://api.github.com/users/gaurish/repos", "type": "User", "html_url": "https://github.com/gaurish", "starred_url": "https://api.github.com/users/gaurish/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gaurish/subscriptions", "following_url": "https://api.github.com/users/gaurish/following{/other_user}", "gravatar_id": "cb0b42e452cd13d469565a23a8abe441", "organizations_url": "https://api.github.com/users/gaurish/orgs", "url": "https://api.github.com/users/gaurish", "gists_url": "https://api.github.com/users/gaurish/gists{/gist_id}", "avatar_url": "https://1.gravatar.com/avatar/cb0b42e452cd13d469565a23a8abe441?d=https%3A%2F%2Fidenticons.github.com%2F58861ae4fb7b472c95e64685229ad9ed.png", "id": 235844, "events_url": "https://api.github.com/users/gaurish/events{/privacy}", "login": "gaurish", "received_events_url": "https://api.github.com/users/gaurish/received_events", "followers_url": "https://api.github.com/users/gaurish/followers"}, "body": "Yes. It is correct. I will try to explain what I think is happening, correct me if I am wrong:\r\n\r\ntypically the superclass error comes when we do something like this:\r\n```ruby\r\nclass AbstractAdapter\r\nend\r\n\r\nclass Abstract\r\nend\r\n\r\nclass PostgreSQLAdapter < AbstractAdapter\r\nend\r\n\r\nclass PostgreSQLAdapter < Abstract\r\nend\r\n\r\npg = PostgreSQLAdapter.new\r\n```\r\nIf you run the above code, it will throw an `superclass mismatch for class PostgreSQLAdapter (TypeError)` because we are trying to redefine superclass from `AbstractAdapter` to `Abstract`.  This makes sense.But what if we money-patch a class & refine its superclass again to the same it was before? this is the problem we are seeing. First we define `PostgresSqlAdapter < AbstractAdapter` in `postgresq_adapter.rb` & then later while monkey patching in `quoting.rb` &  `statement_pool_test.rb` we define the class again as `PostgresSqlAdapter < AbstractAdapter`. Here, if we had changed the superclass; the `TypeError` would have made sense. \r\n\r\nBut, Instead we are setting it to same class it was before(`AbstractAdapter`). so not changing the superclass but still overriding it. haven't not been able to pin point the exact reason why this fails on JRuby but works on MRI but I am guessing its due to the fact we shouldn't override superclass of an existing class while monkeypatching. \r\n\r\nAFAIK, while reopening an already defined class its not required to define its superclass as class takes up the ancestor chain from where it was [first defined](https://github.com/gaurish/rails/blob/0be9609aed44cce7c3db31729b100022c8a6ac2c/activerecord/lib/active_record/connection_adapters/postgresql_adapter.rb#L269). \r\n\r\n`PostgreSQLAdapter` already inherits from `AbstractAdapter`.  So we can skip the inheritance part during monkey-patching and it would still work as as expected. proof:  all the tests are green.\r\n\r\n\r\nWondering if it makes sense now?\r\n\r\nPS: [here is the error which this PR fixes](https://gist.github.com/gaurish/6664468)", "_id": {"$oid": "52428c5cbd354335e70000b4"}, "html_url": "https://github.com/rails/rails/pull/12315#issuecomment-24892016"}
