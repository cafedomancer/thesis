{"updated_at": "2012-09-21T06:49:59Z", "repo": "rails", "created_at": "2012-09-21T06:49:59Z", "owner": "rails", "url": "https://api.github.com/repos/rails/rails/issues/comments/8756472", "id": 8756472, "issue_url": "https://api.github.com/repos/rails/rails/issues/7713", "issue_id": 7713, "user": {"repos_url": "https://api.github.com/users/porras/repos", "type": "User", "html_url": "https://github.com/porras", "starred_url": "https://api.github.com/users/porras/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/porras/subscriptions", "following_url": "https://api.github.com/users/porras/following{/other_user}", "gravatar_id": "45742831d67c80d12cd7b24907b8d760", "organizations_url": "https://api.github.com/users/porras/orgs", "url": "https://api.github.com/users/porras", "gists_url": "https://api.github.com/users/porras/gists{/gist_id}", "avatar_url": "https://2.gravatar.com/avatar/45742831d67c80d12cd7b24907b8d760?d=https%3A%2F%2Fidenticons.github.com%2Ffcde14913c766cf307c75059e0e89af5.png", "id": 3830, "events_url": "https://api.github.com/users/porras/events{/privacy}", "login": "porras", "received_events_url": "https://api.github.com/users/porras/received_events", "followers_url": "https://api.github.com/users/porras/followers"}, "body": "Sure!\n\nThe issue arised when updating an old 2.3.x app, firstly to 3.0 as a first step (but I have reviewed the code and it's mostly the same since then). In that app, we open an uploaded .xls file using the [Spreadsheet](https://github.com/zdavatz/spreadsheet) gem. That gem doesn't like to be passed opened files (it crashes), so we closed it before passing it:\n\n```ruby\nparams[:file].close\ndata = Spreadsheet.open(params[:file].path)\n```\n\nIn 2.3.x params[:file] would be an IO (StringIO or File depending on the size IIRC), so that would work. In 3.x it's an ActionDispatch::Http::UploadedFile, which implements part of the IO API, but not `close`, so of course it fails. We could do `params[:file].tempfile.close` but, apart from being a bit ugly to access to that internal detail, that break the tests, implemented with Webrat's `attach_file`, which gives you a `File`, which has `close` but not `tempfile`.\n\nI think it's fair to say that UploadedFile *quacks like an IO* (duck typing FTW), that's why I think it's a good idea to expose one more method from that API.", "_id": {"$oid": "523dcf5ebd354364b900a52b"}, "html_url": "https://github.com/rails/rails/pull/7713#issuecomment-8756472"}
