{"body": "That's... interesting.  I can reproduce that locally, so that's good.  I refactored the code a bit, still get the same errors, but now this happens:\n\nRun eager_test.rb alone, test passes:\n\n    $ ARCONN=postgresql bundle exec ruby -Itest test/cases/associations/eager_test.rb \n    Finished tests in 4.363282s, 31.3984 tests/s, 93.9660 assertions/s.\n    137 tests, 410 assertions, 0 failures, 0 errors, 0 skips\n\nRun with connection_pool.rb alone, test passes:\n\n    $ ARCONN=postgresql bundle exec ruby -Itest test/cases/connection_pool_test.rb\n    Finished tests in 7.867991s, 2.1607 tests/s, 5.2110 assertions/s.\n    17 tests, 41 assertions, 0 failures, 0 errors, 0 skips\n\nRun them together, tests pass:\n\n    $ ARCONN=postgresql bundle exec ruby -Itest -e '[\"test/cases/connection_pool_test.rb\", \"test/cases/associations/eager_test.rb\"].each { |f| load f }'\n    Finished tests in 13.071680s, 11.7812 tests/s, 34.5021 assertions/s.\n    154 tests, 451 assertions, 0 failures, 0 errors, 0 skips\n\nBut run the all the tests with the rake command, and I get those same failures.\n\nAny ideas?  I suppose I can try running larger and larger subsets of the tests to try to narrow it down...  Or better, find out what rake is doing that plain ruby isn't.\n\n(We've backported this patch to the 3.0 series, but this will be a blocker to us upgrading to 4.x, and I assume this will be true for many JRuby folks.)", "url": "https://api.github.com/repos/rails/rails/issues/comments/5860511", "created_at": "2012-05-22T22:16:07Z", "html_url": "https://github.com/rails/rails/pull/6416#issuecomment-5860511", "updated_at": "2012-05-22T22:16:07Z", "repo": "rails", "issue_id": 6416, "user": {"following_url": "https://api.github.com/users/pmahoney/following{/other_user}", "events_url": "https://api.github.com/users/pmahoney/events{/privacy}", "organizations_url": "https://api.github.com/users/pmahoney/orgs", "url": "https://api.github.com/users/pmahoney", "gists_url": "https://api.github.com/users/pmahoney/gists{/gist_id}", "html_url": "https://github.com/pmahoney", "subscriptions_url": "https://api.github.com/users/pmahoney/subscriptions", "avatar_url": "https://0.gravatar.com/avatar/27598e1b77ce41fb0bd8a6fc4a3715d4?d=https%3A%2F%2Fidenticons.github.com%2F55d630b2da03cc33c4e3f00c113d14d7.png", "repos_url": "https://api.github.com/users/pmahoney/repos", "received_events_url": "https://api.github.com/users/pmahoney/received_events", "gravatar_id": "27598e1b77ce41fb0bd8a6fc4a3715d4", "starred_url": "https://api.github.com/users/pmahoney/starred{/owner}{/repo}", "login": "pmahoney", "type": "User", "id": 103822, "followers_url": "https://api.github.com/users/pmahoney/followers"}, "owner": "rails", "_id": {"$oid": "523808b2bd3543c15100cc4c"}, "id": 5860511, "issue_url": "https://api.github.com/repos/rails/rails/issues/6416"}
