{"body": "I was thinking I might need to clarify the locking issues.\r\nEventhough SessionStore uses ActiveReord, Rack still handles the session. This is what happens when a single user opens a rails website that uses SessionStore. Say the site has a dashboard that fires 3 ajax requests:\r\n\r\nWithout patch:\r\n\r\n      /widgets/1.js-----[Rack load session] [Rails Render] [Rack saves session ] [Response to user]\r\n      /widgets/2.js-----[Rack load session] [Rails Render] [Rack wait for save ] [Rack saves session] [Response to user]\r\n      /widgets/3.js-----[Rack load session] [Rails Render] [Rack wait for save ...................  ] [Rack saves session] [Response to user]\r\n\r\nWith patch:\r\n\r\n      /widgets/1.js-----[Rack load session] [Rails Render] [Response to user]\r\n      /widgets/2.js-----[Rack load session] [Rails Render] [Response to user]\r\n      /widgets/3.js-----[Rack load session] [Rails Render] [Response to user]\r\n\r\nThe cause of the wait is the database locking the session row on update. This is what I mean with the locking problem. It will not deadlock, just create a locking queue on your database. This causes your parallel ajax requests to be returned in sequence to the user. Also note that this slowdown will NOT appear in your Rails production log or other analysis tools, because Rails is 'done' when it hands of the request to Rack.\r\n\r\nNext to that, on high load this will hammer your sessions table a lot, but that is not the main issue.", "url": "https://api.github.com/repos/rails/rails/issues/comments/1433478", "created_at": "2011-06-24T16:28:28Z", "html_url": "https://github.com/rails/rails/pull/1846#issuecomment-1433478", "updated_at": "2011-06-24T16:42:02Z", "repo": "rails", "issue_id": 1846, "user": {"following_url": "https://api.github.com/users/barttenbrinke/following{/other_user}", "events_url": "https://api.github.com/users/barttenbrinke/events{/privacy}", "organizations_url": "https://api.github.com/users/barttenbrinke/orgs", "url": "https://api.github.com/users/barttenbrinke", "gists_url": "https://api.github.com/users/barttenbrinke/gists{/gist_id}", "html_url": "https://github.com/barttenbrinke", "subscriptions_url": "https://api.github.com/users/barttenbrinke/subscriptions", "avatar_url": "https://0.gravatar.com/avatar/a49172d1ddae42fa062770b59823c01d?d=https%3A%2F%2Fidenticons.github.com%2F313e98866f7643ecdbf07e2ba4cfc55b.png", "repos_url": "https://api.github.com/users/barttenbrinke/repos", "received_events_url": "https://api.github.com/users/barttenbrinke/received_events", "gravatar_id": "a49172d1ddae42fa062770b59823c01d", "starred_url": "https://api.github.com/users/barttenbrinke/starred{/owner}{/repo}", "login": "barttenbrinke", "type": "User", "id": 8935, "followers_url": "https://api.github.com/users/barttenbrinke/followers"}, "owner": "rails", "_id": {"$oid": "52384d5fbd3543c1510114d9"}, "id": 1433478, "issue_url": "https://api.github.com/repos/rails/rails/issues/1846"}
