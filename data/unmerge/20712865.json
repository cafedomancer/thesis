{"updated_at": "2013-07-09T23:33:48Z", "repo": "rails", "created_at": "2013-07-09T23:33:48Z", "owner": "rails", "url": "https://api.github.com/repos/rails/rails/issues/comments/20712865", "id": 20712865, "issue_url": "https://api.github.com/repos/rails/rails/issues/11168", "issue_id": 11168, "user": {"repos_url": "https://api.github.com/users/NZKoz/repos", "type": "User", "html_url": "https://github.com/NZKoz", "starred_url": "https://api.github.com/users/NZKoz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NZKoz/subscriptions", "following_url": "https://api.github.com/users/NZKoz/following{/other_user}", "gravatar_id": "efa76b164a7de4a5730e4fa397cc4425", "organizations_url": "https://api.github.com/users/NZKoz/orgs", "url": "https://api.github.com/users/NZKoz", "gists_url": "https://api.github.com/users/NZKoz/gists{/gist_id}", "avatar_url": "https://2.gravatar.com/avatar/efa76b164a7de4a5730e4fa397cc4425?d=https%3A%2F%2Fidenticons.github.com%2F85d8ce590ad8981ca2c8286f79f59954.png", "id": 197, "events_url": "https://api.github.com/users/NZKoz/events{/privacy}", "login": "NZKoz", "received_events_url": "https://api.github.com/users/NZKoz/received_events", "followers_url": "https://api.github.com/users/NZKoz/followers"}, "body": "This isn't actually backwards compatible either as digests generated by this code can't be read by the old code, I don't think this is a bad thing necessarily, but it's not backwards compatible:\r\n\r\n```ruby\r\nirb(main):001:0> mv = ActiveSupport::MessageVerifier.new(\"lolsosecret\")\r\n=> #<ActiveSupport::MessageVerifier:0x007f82aa71e740 @secret=\"lolsosecret\", @digest=\"SHA1\", @serializer=Marshal>\r\nirb(main):002:0> old = mv.generate(\"I am old\")\r\n=> \"BAhJIg1JIGFtIG9sZAY6BkVU--caff953d49a2d68443051b40ad6a36bd6b850970\"\r\nirb(main):003:0> new = \"BAhJIg1JIGFtIG9sZAY6BkVU--#{Time.now.to_i}--caff953d49a2d68443051b40ad6a36bd6b850970\"\r\n=> \"BAhJIg1JIGFtIG9sZAY6BkVU--1373412772--caff953d49a2d68443051b40ad6a36bd6b850970\"\r\nirb(main):004:0> mv.verify(new)\r\nActiveSupport::MessageVerifier::InvalidSignature: ActiveSupport::MessageVerifier::InvalidSignature\r\n```\r\nI don't think there's actually a way to make this reliably backwards compatible without introducing issues anyway.\r\n\r\nAs for the encryption case, the encryptor signs the data too so there's no need to add expiry to the encryption code, just make sure the args are passed down into the relevant verifier.\r\n\r\nFinally, an option to allow disabling this would be good so that people who *do* have to share cookies between apps which don't get upgraded simultaneously won't suddenly have things stop working.", "_id": {"$oid": "5237d81cbd3543c151008447"}, "html_url": "https://github.com/rails/rails/pull/11168#issuecomment-20712865"}
