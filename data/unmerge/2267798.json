{"issue_url": "https://api.github.com/repos/rails/rails/issues/3189", "repo": "rails", "body": "The recursive Rake call 17882d2a9e8e93a5f6dbe2278deb73269fff30c9 unfortunately introduces a regression between 3.1.0 and 3.1.1 in that it is no longer possible to enhance or manually invoke the `assets:precompile` task without the original task being run multiple times.\r\n\r\nHere's my code:\r\n\r\n```ruby\r\nnamespace :themes do\r\n  task :precompile do\r\n    if ENV[\"RAILS_GROUPS\"].to_s.empty? || ENV[\"RAILS_ENV\"].to_s.empty?\r\n      ENV[\"RAILS_GROUPS\"] ||= \"assets\"\r\n      ENV[\"RAILS_ENV\"]    ||= \"production\"\r\n      ruby $0, *ARGV\r\n    else\r\n      puts \"Precompiling themes...\"\r\n      # ... Run theme compiler\r\n    end\r\n  end\r\nend\r\n\r\nRake::Task['assets:precompile'].enhance(['themes:precompile'])\r\n```\r\n\r\nOn Rails 3.1.0:\r\n\r\n```\r\n$ rake assets:precompile\r\n/Users/sam/.rvm/rubies/ruby-1.9.2-p290/bin/ruby /Users/sam/.rvm/gems/ruby-1.9.2-p290/bin/rake assets:precompile\r\nPrecompiling themes...\r\n```\r\n\r\nand on Rails 3.1.1.rc2:\r\n\r\n```\r\n$ rake assets:precompile\r\n/Users/sam/.rvm/rubies/ruby-1.9.2-p290/bin/ruby /Users/sam/.rvm/gems/ruby-1.9.2-p290/bin/rake assets:precompile\r\nPrecompiling themes...\r\n/Users/sam/.rvm/rubies/ruby-1.9.2-p290/bin/ruby /Users/sam/.rvm/gems/ruby-1.9.2-p290/bin/rake assets:precompile\r\nPrecompiling themes...\r\n/Users/sam/.rvm/rubies/ruby-1.9.2-p290/bin/ruby /Users/sam/.rvm/gems/ruby-1.9.2-p290/bin/rake assets:precompile\r\nPrecompiling themes...\r\n```\r\n\r\nI was wondering whether it actually matters that the digests are added to paths within the versions compiled without digests (i.e. what c1547fcf6d3920e81a56ed032c49ab75faf562d8 tests for). The digest-less versions are built to ensure that requests to asset URLs without digests will still work. In my opinion it should not matter that some of those assets may refer to digested assets. Am I missing something?", "_id": {"$oid": "523839a8bd3543c1510100fb"}, "issue_id": 3189, "url": "https://api.github.com/repos/rails/rails/issues/comments/2267798", "html_url": "https://github.com/rails/rails/pull/3189#issuecomment-2267798", "updated_at": "2011-10-03T00:07:58Z", "user": {"subscriptions_url": "https://api.github.com/users/spohlenz/subscriptions", "events_url": "https://api.github.com/users/spohlenz/events{/privacy}", "repos_url": "https://api.github.com/users/spohlenz/repos", "gists_url": "https://api.github.com/users/spohlenz/gists{/gist_id}", "url": "https://api.github.com/users/spohlenz", "login": "spohlenz", "gravatar_id": "43da0307752bf635c44c33dcdd962a2e", "html_url": "https://github.com/spohlenz", "following_url": "https://api.github.com/users/spohlenz/following{/other_user}", "received_events_url": "https://api.github.com/users/spohlenz/received_events", "organizations_url": "https://api.github.com/users/spohlenz/orgs", "avatar_url": "https://2.gravatar.com/avatar/43da0307752bf635c44c33dcdd962a2e?d=https%3A%2F%2Fidenticons.github.com%2Fd397c2b2be2178fe6247bd50fc97cff2.png", "starred_url": "https://api.github.com/users/spohlenz/starred{/owner}{/repo}", "id": 7600, "followers_url": "https://api.github.com/users/spohlenz/followers", "type": "User"}, "created_at": "2011-10-03T00:07:58Z", "id": 2267798, "owner": "rails"}
