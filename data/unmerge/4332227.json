{"issue_url": "https://api.github.com/repos/rails/rails/issues/5034", "repo": "rails", "body": "@thaidn, HA! apologies for the miscommunication then :)  \r\n\r\nSo in your ticket you mentioned using key derivation functions like pbkdf2 from the secret token for the encryption key and the hmac secret, that sounds like a great option.  I just see two potential issues:\r\n\r\n1) The existing signed-only cookies will have to continue to use the raw value of the secret to ensure backwards compatibility, and that means that the application will, to some extent, continue to be using the raw key in hmacs.  Doesn't that leave us in the same situation we're in now?\r\n\r\n2) We'll need to add a new class to replace MessageEncryptor which does all this transparently and deprecate the old one, this seems fine to me.  The existing class exposes raw cbc encryption which people may already be using to shoot themselves in the foot.\r\n\r\nSo to summarize the suggested approach:\r\n\r\n1) New `Message...Something` class, which is initialized with a secret, and uses pbkdf2 to generate 'key' and 'secret' from that value in a deterministic fashion\r\n2) Encrypted cookies should use that class internally\r\n\r\nBy replacing MessageEncryptor with another class entirely, we can avoid any backwards compatibility issues and also ensure that people aren't inadvertently re-using the secret as a key without hmacs.\r\n\r\n\r\n\r\n\r\n", "_id": {"$oid": "52381d9dbd3543c15100e5e2"}, "issue_id": 5034, "url": "https://api.github.com/repos/rails/rails/issues/comments/4332227", "html_url": "https://github.com/rails/rails/pull/5034#issuecomment-4332227", "updated_at": "2012-03-05T21:28:45Z", "user": {"subscriptions_url": "https://api.github.com/users/NZKoz/subscriptions", "events_url": "https://api.github.com/users/NZKoz/events{/privacy}", "repos_url": "https://api.github.com/users/NZKoz/repos", "gists_url": "https://api.github.com/users/NZKoz/gists{/gist_id}", "url": "https://api.github.com/users/NZKoz", "login": "NZKoz", "gravatar_id": "efa76b164a7de4a5730e4fa397cc4425", "html_url": "https://github.com/NZKoz", "following_url": "https://api.github.com/users/NZKoz/following{/other_user}", "received_events_url": "https://api.github.com/users/NZKoz/received_events", "organizations_url": "https://api.github.com/users/NZKoz/orgs", "avatar_url": "https://0.gravatar.com/avatar/efa76b164a7de4a5730e4fa397cc4425?d=https%3A%2F%2Fidenticons.github.com%2F85d8ce590ad8981ca2c8286f79f59954.png", "starred_url": "https://api.github.com/users/NZKoz/starred{/owner}{/repo}", "id": 197, "followers_url": "https://api.github.com/users/NZKoz/followers", "type": "User"}, "created_at": "2012-03-05T21:28:33Z", "id": 4332227, "owner": "rails"}
