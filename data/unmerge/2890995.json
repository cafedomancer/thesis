{"issue_url": "https://api.github.com/repos/rails/rails/issues/3762", "repo": "rails", "body": "I checked out a new 3.1.3 Rails project.\r\n\r\nThis is the failing test:\r\n\r\nclass UserTest < ActiveSupport::TestCase\r\n\r\n  def test_address\r\n    u = User.new(:name => \"Peter\")\r\n    a = u.build_address(:city => \"Leuven\")\r\n    assert u.to_xml(:include => :address) =~ /<address/  # it gives adres with 1 s\r\n  end\r\n\r\nend\r\n\r\ncontext:\r\n\r\nclass User\r\n  has_one :address\r\nend\r\n\r\nThis test fails in the standard Rails 3.1.3, but can be made to\r\npass with this modification to inflections:\r\n\r\nActiveSupport::Inflector.inflections do |inflect|\r\n  inflect.singular /^(a)ddress/i, '\\1ddress'\r\nend\r\n\r\nThe root causes are (IMHO):\r\n\r\n* without the added inflection, I see this:\r\n\r\n$ rails c\r\nLoading development environment (Rails 3.1.3)\r\n001:0> \"address\".singularize\r\n=> \"addres\"\r\n\r\nIn file activerecord-3.1.3/lib/active_record/serializers/xml_serializer.rb\r\nthis code (line 199) miscalculates the \"association_name\" to \"addres\" (with 1 's').\r\n\r\n  class XmlSerializer < ActiveModel::Serializers::Xml::Serializer #:nodoc:\r\n...\r\n    def add_includes\r\n      procs = options.delete(:procs)\r\n      @serializable.send(:serializable_add_includes, options) do |association, records, opts|\r\n        add_associations(association, records, opts)\r\n      end\r\n      options[:procs] = procs\r\n    end\r\n\r\n    # TODO This can likely be cleaned up to simple use ActiveSupport::XmlMini.to_tag as well.\r\n    def add_associations(association, records, opts)\r\n      association_name = association.to_s.singularize #### LINE 199  ###########\r\n      merged_options   = options.merge(opts).merge!(:root => association_name, :skip_instruct => true)\r\n\r\n\r\nI can also make the test pass (without adding the inflection), with changing line 199 to:\r\n\r\n      association_name = association.to_s # .singularize\r\n\r\nHTH,\r\n\r\nPeter", "_id": {"$oid": "52383206bd3543c15100f83c"}, "issue_id": 3762, "url": "https://api.github.com/repos/rails/rails/issues/comments/2890995", "html_url": "https://github.com/rails/rails/pull/3762#issuecomment-2890995", "updated_at": "2011-11-27T23:19:32Z", "user": {"subscriptions_url": "https://api.github.com/users/petervandenabeele/subscriptions", "events_url": "https://api.github.com/users/petervandenabeele/events{/privacy}", "repos_url": "https://api.github.com/users/petervandenabeele/repos", "gists_url": "https://api.github.com/users/petervandenabeele/gists{/gist_id}", "url": "https://api.github.com/users/petervandenabeele", "login": "petervandenabeele", "gravatar_id": "160992dfd434ff7055465446b9423bd5", "html_url": "https://github.com/petervandenabeele", "following_url": "https://api.github.com/users/petervandenabeele/following{/other_user}", "received_events_url": "https://api.github.com/users/petervandenabeele/received_events", "organizations_url": "https://api.github.com/users/petervandenabeele/orgs", "avatar_url": "https://1.gravatar.com/avatar/160992dfd434ff7055465446b9423bd5?d=https%3A%2F%2Fidenticons.github.com%2F1aef1e834b4c31bd58191d7457cd5e64.png", "starred_url": "https://api.github.com/users/petervandenabeele/starred{/owner}{/repo}", "id": 55656, "followers_url": "https://api.github.com/users/petervandenabeele/followers", "type": "User"}, "created_at": "2011-11-27T23:19:32Z", "id": 2890995, "owner": "rails"}
