{"body": "Combining the existing logic with a valid-IP check results in strange behavior, though, like returning a proxy IP as the client IP.\r\n\r\n```ruby\r\n    #HTTP_X_FORWARDED_FOR may be a comma-\r\n    # delimited list in the case of multiple chained proxies; the last\r\n    # address which is not trusted is the originating IP.\r\n```\r\n\r\nThis is unclear, unfortunately. What does it mean by \"last address?\" That implies that proxies are adding their address to the beginning of the header instead of the end. That seems wrong. Maybe the git history can reveal more of the intention here.\r\n\r\nI think it's best to support correct use of the header: the first address is the client IP, the second address in the first proxy, the third address is the second proxy, and so on.", "url": "https://api.github.com/repos/rails/rails/issues/comments/2349120", "created_at": "2011-10-10T16:20:43Z", "html_url": "https://github.com/rails/rails/pull/2035#issuecomment-2349120", "updated_at": "2011-10-10T16:20:43Z", "repo": "rails", "issue_id": 2035, "user": {"following_url": "https://api.github.com/users/jeremy/following{/other_user}", "events_url": "https://api.github.com/users/jeremy/events{/privacy}", "organizations_url": "https://api.github.com/users/jeremy/orgs", "url": "https://api.github.com/users/jeremy", "gists_url": "https://api.github.com/users/jeremy/gists{/gist_id}", "html_url": "https://github.com/jeremy", "subscriptions_url": "https://api.github.com/users/jeremy/subscriptions", "avatar_url": "https://1.gravatar.com/avatar/24d2f8804e6bb4b7ea6bd11e0a586470?d=https%3A%2F%2Fidenticons.github.com%2F84d9ee44e457ddef7f2c4f25dc8fa865.png", "repos_url": "https://api.github.com/users/jeremy/repos", "received_events_url": "https://api.github.com/users/jeremy/received_events", "gravatar_id": "24d2f8804e6bb4b7ea6bd11e0a586470", "starred_url": "https://api.github.com/users/jeremy/starred{/owner}{/repo}", "login": "jeremy", "type": "User", "id": 199, "followers_url": "https://api.github.com/users/jeremy/followers"}, "owner": "rails", "_id": {"$oid": "523fe378bd354364b901bf90"}, "id": 2349120, "issue_url": "https://api.github.com/repos/rails/rails/issues/2035"}
