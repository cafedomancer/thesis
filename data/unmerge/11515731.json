{"issue_url": "https://api.github.com/repos/rails/rails/issues/8307", "repo": "rails", "body": "@blowmage The main drawback of integration testing setup is that it's slower than functional testing. So one way to help is to massively speed up integration tests. Profile the code and make it at least as fast as an equivalent functional test.\r\n\r\nHere's a start, comparing functional & integration tests of a simple action:\r\n\r\nFunctional:\r\n```\r\n1.9.3-p327 ~/work/apps/bcx master= cat test/functional/bakeoff_test.rb \r\nrequire 'test_helper'\r\n\r\nclass BakeoffTest < ActionController::TestCase\r\n  tests MonitoringController\r\n\r\n  100.times do |i|\r\n    test \"bake #{i}\" do\r\n      get :index\r\n      assert_response :ok\r\n    end\r\n  end\r\nend\r\n\r\n1.9.3-p327 ~/work/apps/bcx master= time ruby -Itest:lib test/functional/bakeoff_test.rb \r\nRun options: \r\n\r\n# Running tests:\r\n\r\n....................................................................................................\r\n\r\nFinished tests in 1.897544s, 52.6997 tests/s, 52.6997 assertions/s.\r\n\r\n100 tests, 100 assertions, 0 failures, 0 errors, 0 skips\r\n\r\nreal\t0m9.597s\r\nuser\t0m7.338s\r\nsys\t0m1.669s\r\n```\r\n\r\nIntegration\r\n```\r\n1.9.3-p327 ~/work/apps/bcx master= cat test/integration/bakeoff_test.rb \r\nrequire 'test_helper'\r\n\r\nclass BakeoffTest < ActionDispatch::IntegrationTest\r\n  100.times do |i|\r\n    test \"bake #{i}\" do\r\n      get '/up'\r\n      assert_response :ok\r\n    end\r\n  end\r\nend\r\n\r\n1.9.3-p327 ~/work/apps/bcx master= time ruby -Itest:lib test/integration/bakeoff_test.rb \r\nRun options: \r\n\r\n# Running tests:\r\n\r\n....................................................................................................\r\n\r\nFinished tests in 3.184533s, 31.4018 tests/s, 31.4018 assertions/s.\r\n\r\n100 tests, 100 assertions, 0 failures, 0 errors, 0 skips\r\n\r\nreal\t0m10.898s\r\nuser\t0m8.685s\r\nsys\t0m1.679s\r\n```\r\n\r\nThe integration tests are roughly 40% slower. Let's erase that gap!", "_id": {"$oid": "5237f450bd3543c15100a9eb"}, "issue_id": 8307, "url": "https://api.github.com/repos/rails/rails/issues/comments/11515731", "html_url": "https://github.com/rails/rails/pull/8307#issuecomment-11515731", "updated_at": "2012-12-19T03:01:46Z", "user": {"subscriptions_url": "https://api.github.com/users/jeremy/subscriptions", "events_url": "https://api.github.com/users/jeremy/events{/privacy}", "repos_url": "https://api.github.com/users/jeremy/repos", "gists_url": "https://api.github.com/users/jeremy/gists{/gist_id}", "url": "https://api.github.com/users/jeremy", "login": "jeremy", "gravatar_id": "24d2f8804e6bb4b7ea6bd11e0a586470", "html_url": "https://github.com/jeremy", "following_url": "https://api.github.com/users/jeremy/following{/other_user}", "received_events_url": "https://api.github.com/users/jeremy/received_events", "organizations_url": "https://api.github.com/users/jeremy/orgs", "avatar_url": "https://2.gravatar.com/avatar/24d2f8804e6bb4b7ea6bd11e0a586470?d=https%3A%2F%2Fidenticons.github.com%2F84d9ee44e457ddef7f2c4f25dc8fa865.png", "starred_url": "https://api.github.com/users/jeremy/starred{/owner}{/repo}", "id": 199, "followers_url": "https://api.github.com/users/jeremy/followers", "type": "User"}, "created_at": "2012-12-19T03:01:46Z", "id": 11515731, "owner": "rails"}
