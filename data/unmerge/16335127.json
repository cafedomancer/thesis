{"body": "You are right.\r\n\r\nIn the current implementation, the thread local is only checked on demand, and if a explain is going on this code sets the collection to fill:\r\n\r\nhttps://github.com/rails/rails/blob/master/activerecord/lib/active_record/explain.rb#L8\r\n\r\nThe `finish` method of the subscriber uses the thread local also as a flag that indicates whether a EXPLAIN is going on. If we are collecting queries the collection should be filled, otherwise there are no queries to collect, do nothing.\r\n\r\nBut with your refactor we have a canonical place to initialize this with a default, and I prefer anything that is plural to return a collection, an empty array is a better default in my view.\r\n\r\nThen, the initializer could set an actual flag, and the subscriber could fill the collection if the flag is active.\r\n\r\nGranted, the default empty array is never used, but I find that setup to be more intuitive. I believe @jeremy sees it the same way.\r\n", "url": "https://api.github.com/repos/rails/rails/issues/comments/16335127", "created_at": "2013-04-13T15:34:36Z", "html_url": "https://github.com/rails/rails/pull/10198#issuecomment-16335127", "updated_at": "2013-04-13T15:34:36Z", "repo": "rails", "issue_id": 10198, "user": {"following_url": "https://api.github.com/users/fxn/following{/other_user}", "events_url": "https://api.github.com/users/fxn/events{/privacy}", "organizations_url": "https://api.github.com/users/fxn/orgs", "url": "https://api.github.com/users/fxn", "gists_url": "https://api.github.com/users/fxn/gists{/gist_id}", "html_url": "https://github.com/fxn", "subscriptions_url": "https://api.github.com/users/fxn/subscriptions", "avatar_url": "https://0.gravatar.com/avatar/7223c62b7310e164eb79c740188abbda?d=https%3A%2F%2Fidenticons.github.com%2F4a11654ad1e1e48352252859ff3032a0.png", "repos_url": "https://api.github.com/users/fxn/repos", "received_events_url": "https://api.github.com/users/fxn/received_events", "gravatar_id": "7223c62b7310e164eb79c740188abbda", "starred_url": "https://api.github.com/users/fxn/starred{/owner}{/repo}", "login": "fxn", "type": "User", "id": 3387, "followers_url": "https://api.github.com/users/fxn/followers"}, "owner": "rails", "_id": {"$oid": "523cf0b6bd354364b900354f"}, "id": 16335127, "issue_url": "https://api.github.com/repos/rails/rails/issues/10198"}
