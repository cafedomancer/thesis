{"body": "I also experimented with a native impl. I'm not opposed to adding this, or helping to get a native ext written in C and Java versions. The JRuby version is pretty simple.\r\n\r\nJRuby impl:\r\n\r\n```java\r\n    @JRubyMethod\r\n    public IRubyObject secure_compare(ThreadContext context, IRubyObject other) {\r\n        Ruby runtime = context.runtime;\r\n        \r\n        if (!(other instanceof RubyString)) return runtime.getFalse();\r\n        \r\n        ByteList a = value;\r\n        ByteList b = ((RubyString)other).value;\r\n        \r\n        if (a.getRealSize() != b.getRealSize()) return runtime.getFalse();\r\n        \r\n        boolean ok = true;\r\n        for (int i = 0; i < a.getRealSize(); i++) {\r\n            ok = ok && (a.get(i) == b.get(i));\r\n        }\r\n        \r\n        return runtime.newBoolean(ok);\r\n    }\r\n```\r\n\r\nAnd numbers:\r\n\r\n```\r\next-jruby-local ~/projects/jruby $ (pickjdk 5 ; jruby -rbenchmark secure_compare.rb)\r\nNew JDK: jdk1.8.0_hotspot-comp\r\nRehearsal ------------------------------------\r\n   5.080000   0.100000   5.180000 (  4.026000)\r\n   1.620000   0.010000   1.630000 (  1.418000)\r\n   0.290000   0.000000   0.290000 (  0.180000)\r\n--------------------------- total: 7.100000sec\r\n\r\n       user     system      total        real\r\n   3.380000   0.010000   3.390000 (  3.304000)\r\n   1.220000   0.010000   1.230000 (  1.225000)\r\n   0.120000   0.000000   0.120000 (  0.129000)\r\n```", "url": "https://api.github.com/repos/rails/rails/issues/comments/13335498", "created_at": "2013-02-09T18:12:02Z", "html_url": "https://github.com/rails/rails/pull/9230#issuecomment-13335498", "updated_at": "2013-02-09T18:12:02Z", "repo": "rails", "issue_id": 9230, "user": {"following_url": "https://api.github.com/users/headius/following{/other_user}", "events_url": "https://api.github.com/users/headius/events{/privacy}", "organizations_url": "https://api.github.com/users/headius/orgs", "url": "https://api.github.com/users/headius", "gists_url": "https://api.github.com/users/headius/gists{/gist_id}", "html_url": "https://github.com/headius", "subscriptions_url": "https://api.github.com/users/headius/subscriptions", "avatar_url": "https://2.gravatar.com/avatar/f1d37642fdaa1662ff46e4c65731e9ab?d=https%3A%2F%2Fidenticons.github.com%2F36bedb6eb7152f39b16328448942822b.png", "repos_url": "https://api.github.com/users/headius/repos", "received_events_url": "https://api.github.com/users/headius/received_events", "gravatar_id": "f1d37642fdaa1662ff46e4c65731e9ab", "starred_url": "https://api.github.com/users/headius/starred{/owner}{/repo}", "login": "headius", "type": "User", "id": 10135, "followers_url": "https://api.github.com/users/headius/followers"}, "owner": "rails", "_id": {"$oid": "5237ebebbd3543c151009be4"}, "id": 13335498, "issue_url": "https://api.github.com/repos/rails/rails/issues/9230"}
