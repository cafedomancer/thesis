{"issue_url": "https://api.github.com/repos/rails/rails/issues/9044", "repo": "rails", "body": "Recapping a bit, but...\r\n\r\n_id2ref is no good because it's not universally supported, or it's implemented in a slow way (usually out of necessity), and it's actually considered internal to MRI by matz. As @dbussink points out, it also doesn't guarantee anything about which object you have, which is why MRI WeakRef doesn't work.\r\n\r\nMRI WeakRef doesn't work because it's implemented on _id2ref up until Ruby 2.0.0, at which point it is implemented using an internal GC-aware reference queue. If that version could be backported into my \"weakling\" gem, you'd have a safe WeakRef across impls. WeakRef on Rubinius and JRuby are already (and have always been) implemented correctly.\r\n\r\nHowever...WeakRef is no solution here either. WeakRefs are not guaranteed to collect in any specific amount of time, and using them for resource cleanup (as here) will *always* run the risk of eating up resources faster than they can be reclaimed. In practice, they do run...but under load, or if objects get promoted to older generations on JRuby and Rubinius, it may take a long time.\r\n\r\nIf you really want to manage a limited resource, you really should box their use inside a begin/ensure somewhere and clean them up actively rather than lazily.", "_id": {"$oid": "5237ed5ebd3543c151009e17"}, "issue_id": 9044, "url": "https://api.github.com/repos/rails/rails/issues/comments/12658609", "html_url": "https://github.com/rails/rails/pull/9044#issuecomment-12658609", "updated_at": "2013-01-24T16:14:34Z", "user": {"subscriptions_url": "https://api.github.com/users/headius/subscriptions", "events_url": "https://api.github.com/users/headius/events{/privacy}", "repos_url": "https://api.github.com/users/headius/repos", "gists_url": "https://api.github.com/users/headius/gists{/gist_id}", "url": "https://api.github.com/users/headius", "login": "headius", "gravatar_id": "f1d37642fdaa1662ff46e4c65731e9ab", "html_url": "https://github.com/headius", "following_url": "https://api.github.com/users/headius/following{/other_user}", "received_events_url": "https://api.github.com/users/headius/received_events", "organizations_url": "https://api.github.com/users/headius/orgs", "avatar_url": "https://2.gravatar.com/avatar/f1d37642fdaa1662ff46e4c65731e9ab?d=https%3A%2F%2Fidenticons.github.com%2F36bedb6eb7152f39b16328448942822b.png", "starred_url": "https://api.github.com/users/headius/starred{/owner}{/repo}", "id": 10135, "followers_url": "https://api.github.com/users/headius/followers", "type": "User"}, "created_at": "2013-01-24T16:13:56Z", "id": 12658609, "owner": "rails"}
