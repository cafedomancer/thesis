{"updated_at": "2013-05-21T09:28:44Z", "repo": "rails", "created_at": "2013-05-21T09:28:16Z", "owner": "rails", "url": "https://api.github.com/repos/rails/rails/issues/comments/18197986", "id": 18197986, "issue_url": "https://api.github.com/repos/rails/rails/issues/10706", "issue_id": 10706, "user": {"repos_url": "https://api.github.com/users/josevalim/repos", "type": "User", "html_url": "https://github.com/josevalim", "starred_url": "https://api.github.com/users/josevalim/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/josevalim/subscriptions", "following_url": "https://api.github.com/users/josevalim/following{/other_user}", "gravatar_id": "e837f6b7fd146ab16ed3d663476c063e", "organizations_url": "https://api.github.com/users/josevalim/orgs", "url": "https://api.github.com/users/josevalim", "gists_url": "https://api.github.com/users/josevalim/gists{/gist_id}", "avatar_url": "https://1.gravatar.com/avatar/e837f6b7fd146ab16ed3d663476c063e?d=https%3A%2F%2Fidenticons.github.com%2Fe20b21ae6508f22fc189c60a0880d0b8.png", "id": 9582, "events_url": "https://api.github.com/users/josevalim/events{/privacy}", "login": "josevalim", "received_events_url": "https://api.github.com/users/josevalim/received_events", "followers_url": "https://api.github.com/users/josevalim/followers"}, "body": "A global variable doesn't mean it is public. All named classes are global, it doesn't mean all classes are public. :)\r\n\r\nThe proper solution, regardless of the Rails version, is to move that initializer block inside a rake block. Try this:\r\n\r\n```ruby\r\nmodule Postamt\r\n  class Railtie < Rails::Railtie\r\n    railtie_name \"postamt\"\r\n\r\n    rake do\r\n      # We mustn't hook into AR when db:migrate or db:test:load_schema\r\n      # run, but user-defined Rake tasks still need us\r\n      task_names = []\r\n      tasks_to_examine = Rake.application.top_level_tasks.map{ |task_name| Rake.application[task_name] }\r\n      until tasks_to_examine.empty?\r\n        task = tasks_to_examine.pop\r\n        task_names << task.name\r\n        tasks_to_examine += task.prerequisite_tasks\r\n      end\r\n      next if task_names.any? { |task_name| task_name.start_with? \"db:\" }\r\n    end\r\n\r\n    initializer \"postamt.hook\", before: \"active_record.initialize_database\" do |app|\r\n      Postamt.hook!\r\n    end\r\n  end\r\nend\r\n```\r\n\r\n", "_id": {"$oid": "5237dc4ebd3543c1510089a3"}, "html_url": "https://github.com/rails/rails/pull/10706#issuecomment-18197986"}
